{% assign listing_cols = '1' %}
{% assign image_size = 'original' %}
{% assign featured_collections = 'all' %}
{% assign coll_num = 1 %}
{% if settings.feat_coll_serdang != blank %}
  {% assign featured_collections = settings.feat_coll_serdang | split:"," %}
{% endif %}

{% if settings.display_featured_collections == true and featured_collections.size > 0 %}
  <!-- Featured Collections Slider -->

<script>var ajaxCall = 0; var ajaxSuccess = 0; showLoading();</script>

  {% for featured_collection in featured_collections %}

    {% assign coll = featured_collection | strip %}
    {% assign coll_relative_link = '/collections/' | append: collections[featured_collection].handle %}
    {% assign collection_count = collections[coll].all_products_count | times: 1 %}
  
    {% if coll != blank and collection_count != nil and collection_count > 0 %}  
      
      <section class="bestsell-pro newslider{{ forloop.index }}">
        <div class="container"> 
          <div class="block-title">
            <h2><a href= "{{ coll_relative_link }}">{{ collections[coll].title }}  </a></h2>
          </div>
          <div class="slider-items-products"> 
            <div class="bestsell-block">
              <div id="featured-slider_{{ coll_num }}" class="product-flexslider hidden-buttons">
                <div class="slider-items slider-width-col4 products-grid block-content"> 
                  <!-- Item --> 
                  {% for product in collections[coll].products limit:1000 %}                      
                    <div class="item txtpk {% for tag in product.tags %}  {{tag}} {% endfor %} ">                      
                      {% include 'product-grid-item' with 'listing_cols' with 'image_size' %} </div>
                     
                  {% endfor %} 
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>      
      <script type="text/javascript">
        $(document).ready(function(){
          var collectionno = '{{ collections[coll].id }}';
          var tag = $.cookie('PasarStoreId');
          var market = $.cookie('PasarStoreName');
          var appendplace = '.newslider{{ forloop.index }}';
          ajaxCall++;
          
          $.ajax({
            url: "https://www.shopifyappexperts.com/localdelivery/ajax_home_feature.php",
            type: "POST",
            data: {
                    tag: tag,
                    collectionno: collectionno
                  },
            dataType: "json",
            success: function(response) {
              if (response.true != '') {
                var html{{ coll_num }} = '';
                var tags = [];
                
                $.each(response.data, function( index, value ) {   
                  var imgthum = 'https://cdn.shopify.com/s/assets/no-image-2048-5e88c1b20e087fb7bbe9a3771824e743c244f437e4f8ba93bbf7b11b53f7824c_large.gif';
                  if(value['image'] != null){
                    imgthum = value['image']['src'];
                  }

                  tags = value['tags'];
                  html{{ coll_num }} += '<div class="item '+value['tags']+'">'           
                  html{{ coll_num }} += '<div data-id='+value['id']+' class=" '+value['tags']+'   product-'+value['id']+' product product__product-grid-item product-item col-sm-12 item_odd step3-1 step4-1">';
                  html{{ coll_num }} += '<div class="item-inner">';
                  html{{ coll_num }} += '<div class="product_image-wrap item-img">';
                  html{{ coll_num }} += '<a href="/products/'+value['handle']+'" class="product-grid-image" ><img src='+imgthum+' title="'+value['title']+'" alt="'+value['title']+'"></a>';
                  html{{ coll_num }} +='</div>';
                  html{{ coll_num }} +='<div class="box-hover"><ul class="add-to-links"><li></li></ul></div><div class="color-swich"></div>';
                  html{{ coll_num }} +=' <div class="product_title-wrap"><a href="/products/'+value['handle']+'" class="product_title">'+value['title']+'</a></div>'
                  html{{ coll_num }} += '<span style="color:grey">'+value['options'][0]['values'][0]+'</span>';
                  html{{ coll_num }} +='<div class="product_price"><span class="money">RM'+value['variants'][0]['price']+'</span></div>';
                  html{{ coll_num }} +='<form id="addToCartContainer" action="/cart/add" method="post" enctype="multipart/form-data" data-id="'+value['id']+'" class="addToCartForm product-actions-'+value['id']+'"><div class="cart-buttons" style="display:none"><input type="hidden" name="id" value="'+value['variants'][0]['id']+'"><button type="submit" name="minus" class="btn-remove-from-cart"><i class="fa fa-minus" aria-hidden="true"></i></button><input type="text" id="quantity" name="quantity" value="1" class="add-to-cart-quantity-cart" readonly=""><button type="submit" name="add" class="btn-add-to-cart"><i class="fa fa-plus" aria-hidden="true"></i></button></div><div class="single-add-to-cart-button" style=""> <input type="hidden" name="id" value="'+value['variants'][0]['id']+'"><button type="submit" name="add" class="btn btn-primary addToCart add-to-cart-btn homeaddtocart"><span class="addToCartText">Add to cart</span></button></div></form>';
                  html{{ coll_num }} +='</div>';
                  html{{ coll_num }} +='</div>';
                  html{{ coll_num }} +='</div>';
                }); 
 
                $("#featured-slider_{{ coll_num }}").find(".slider-items").html(html{{ coll_num }});
                ajaxSuccess++;
              }
                  
              if(ajaxCall == ajaxSuccess) {
                InitCarousal();
                hideLoading();
              }
            }
          }); 
        });   
        
      </script>
      {% assign coll_num = coll_num | plus: 1 %}
    {% endif %}
  {% endfor %}
  <!-- End Featured Collections Slider --> 

  <script type="text/javascript">
    //<![CDATA[
    function InitCarousal() {
      for (i = 1; i <= {{ coll_num }}; i++) { 
      index = "#featured-slider_" + i;
      jQuery(index + " .slider-items").owlCarousel({
      loop:true,
      items: 5, //10 items above 1000px browser width
      itemsDesktop: [1024, 4], //4 items between 1024px and 901px
      itemsDesktopSmall: [900, 3], // 4 items betweem 900px and 601px
      itemsTablet: [640, 2], //3 items between 600 and 0;
      itemsMobile: [375, 2],
      navigation : true,
      navigationText : ["<a class=\"flex-prev\"></a>","<a class=\"flex-next\"></a>"],
      slideSpeed : 500,
      pagination : true,
      autoPlay: false,
      responsive: {
            0: {
              items: 2,
              navigation: true,
              nav: true,
              slideBy: 1 // <!-- HERE
            },
            640: {
              items: 2,
              navigation: true,
              nav: true,
              slideBy: 2 // <!-- HERE
            },
            900: {
              items: 4,
              navigation: true,
              nav: true,
              slideBy: 4 // <!-- HERE
            },
            1024: {
              items: 4,
              navigation: true,
              nav: true,
              slideBy: 4 // <!-- HERE
            },
            1600: {
              items: 5,
              navigation: true,
              nav: true,
              slideBy: 5 // <!-- HERE
            }
          },
      });
    }
    }
    //]]>
  </script>  

{% endif %}